<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            position: relative; /* Ensure body acts as the containing block for absolutely positioned elements */
        }
        #board {
            display: inline-block;
            margin-top: 20px;
            position: relative; /* Set the position to relative to establish a containing block for absolutely positioned player */
            background-size: cover; /* Ensure background image covers the board */
        }
        .cell {
            width: 35px;
            height: 35px;
            border: 1px solid black;
            display: inline-block;
            background-color: rgba(255, 255, 153, 0.8); /* Pale and color-blind accessible color with some transparency */
            border-radius: 10px; /* Smoother edges */
            margin: 1px; /* Add some space between cells */
        }
        .player {
            position: absolute; /* Position the player div relative to its containing block */
            width: 15px; /* Half width as a cell */
            height: 15px; /* Half height as a cell */
            border: 2px solid black; /* Add a border for better visibility */
            box-sizing: border-box; /* Include border in width and height */
            z-index: 1; /* Set a higher z-index to ensure the player is above the board */
            border-radius: 50%; /* Make the player a circle */
        }
        #player1 {
            background-color: rgba(255, 0, 0, 0.8); /* Red color with some transparency */
        }
        #player2 {
            background-color: rgba(0, 0, 255, 0.8); /* Blue color with some transparency */
        }
        #player3 {
            background-color: rgba(0, 255, 0, 0.8); /* Green color with some transparency */
        }
        #player4 {
            background-color: rgba(255, 255, 0, 0.8); /* Yellow color with some transparency */
        }
        #player5 {
            background-color: rgba(255, 0, 255, 0.8); /* Magenta color with some transparency */
        }
        #player6 {
            background-color: rgba(0, 255, 255, 0.8); /* Cyan color with some transparency */
        }
        #debug {
            display: none; /* Hide debug div by default */
            margin-top: 20px;
            border: 1px solid black;
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h3>Slippers Slopes and Leaders Ladder!</h3>
    <p>1. Select: 
    <select id="playerCount">
        <option value="2">2 Players</option>
        <option value="3">3 Players</option>
        <option value="4">4 Players</option>
        <option value="5">5 Players</option>
        <option value="6">6 Players</option>
    </select>
    <button id="startGame">2. Start</button> 
    <button id="rollDice" disabled>3. Roll Dice</button>
    </p>
    <p>
        <div id="board"></div>
    </p>
    <p>
	<button id="toggleDebug">Toggle Debug</button>
        <div id="debug"></div>
    </p>
	
    <script>
        // Array of background image URLs
        const backgroundImages = [
            'https://upload.wikimedia.org/wikipedia/commons/e/ea/Deogarh%2C_Dasavatara-Tempel_Vishnu_%281999%29_%28cropped%29.JPG',
            'https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/1st_to_5th_of_10_Vishnu_avatars_on_Udupi_Hindu_temple_gopuram.jpg/1280px-1st_to_5th_of_10_Vishnu_avatars_on_Udupi_Hindu_temple_gopuram.jpg'
        ];

        // Function to generate a random dice value (1 to 6)
        function rollDice() {
            return Math.floor(Math.random() * 6) + 1;
        }
        // Function to generate a random dice value (1 to 3)
        function rollDiceForLadderRead() {
            return Math.floor(Math.random() * 3) ;
        }
        // Function to generate a random dice value (1 to 2)
        function rollDiceForSlopeRead() {
            return Math.floor(Math.random() * 2) ;
        }

        // Function to check if a number is prime
        function isPrime(number) {
            if (number <= 1) return false;
            if (number <= 3) return true;
            if (number % 2 === 0 || number % 3 === 0) return false;
            let i = 5;
            while (i * i <= number) {
                if (number % i === 0 || number % (i + 2) === 0) return false;
                i += 6;
            }
            return true;
        }

        // Function to find the next prime number
        function getNextPrime(number) {
            let next = number + 1;
            while (!isPrime(next)) {
                next++;
            }
            return next;
        }

        // Function to find the previous prime number
        function getPreviousPrime(number) {
            let prev = number - 1;
            while (!isPrime(prev)) {
                prev--;
            }
            return prev;
        }

        // Function to move the player on the board
        function movePlayer(player, diceValue) {
            // Calculate the new position
            let oldPosition = player.position;
            let newPosition = player.position - diceValue;
            // Check if the new position is within the board bounds
            if (newPosition >= 0) {
                // Update the player's position
                // In the beginning go up ladder fast, later on fall slopes fast
                player.position = newPosition;

                if (isPrime(newPosition + 1) && newPosition + 1 >= 54) {
                    const nextPrime = getNextPrime(newPosition + 1);
                    player.position = nextPrime - 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved to one prime backward ${108 - nextPrime + 1}`, popUpContent: "You landed on a slippery slope. You slid a bit backward!" + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
                } else if (isPrime(newPosition) && newPosition >= 54) {
                    const prevPrevPrevPrime = getPreviousPrime(getPreviousPrime(getPreviousPrime(newPosition)));
                    player.position = prevPrevPrevPrime - 3;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved three primes forward ${108 - prevPrevPrevPrime + 3}`, popUpContent: "You landed on a leader ladder. You jumped way forward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition + 1) && newPosition + 1 >= 27 && newPosition + 1 < 54) {
                    const nextNextPrime = getNextPrime(getNextPrime(newPosition));
                    player.position = nextNextPrime + 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved two primes backward ${108 - nextNextPrime - 1}`, popUpContent: "You landed on a slippery slope. You slid backward!"  + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
                } else if (isPrime(newPosition) && newPosition >= 27 && newPosition < 54) {
                    const prevPrevPrime = getPreviousPrime(getPreviousPrime(newPosition));
                    player.position = prevPrevPrime - 2;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved two primes forward ${108 - prevPrevPrime + 2}`, popUpContent: "You landed on a leader ladder. You jumped quite a bit forward!"  + "\n\n" + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition + 1)) {
                    const nextNextNextPrime = getNextPrime(getNextPrime(getNextPrime(newPosition)));
                    player.position = nextNextNextPrime + 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved three primes backward ${108 - nextNextNextPrime - 1}`, popUpContent: "You landed on a slippery slope. You slid way back!"  + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
                } else if (isPrime(newPosition)) {
                    const prevPrime = getPreviousPrime(newPosition);
                    player.position = prevPrime;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved to one prime forward ${108 - prevPrime}`, popUpContent: "You landed on a leader ladder. You jumped a bit forward!"  + "\n\n" + ladderText[rollDiceForLadderRead()] };
                }

                return { oldPosition, newPosition, message: `Player moved from ${108 - oldPosition} to ${108 - newPosition}`, popUpContent: "" };
            } else {
                // Player has won
                player.position = 0;
                return { oldPosition, newPosition: 0, message: `Player moved from ${108 - oldPosition} to ${108 - newPosition} and won!`, popUpContent: "" };
            }
        }

        // Function to update the player's position on the board
        function updatePlayerPosition(player) {
            const playerElement = document.getElementById(player.id);
            const position = getPositionFromIndex(player.position);
            const cellElement = document.getElementById(`cell-${position.row}-${position.col}`);
            playerElement.style.top = cellElement.offsetTop + 'px';
            playerElement.style.left = cellElement.offsetLeft + 'px';
        }

        // Function to update the debug information
        function updateDebugInfo(moveResult, diceValue) {
            const debugElement = document.getElementById('debug');
            debugElement.innerHTML = `<p>Dice Roll: ${diceValue}</p>
                                      <p>${moveResult.message}</p>`;
            if (moveResult.popUpContent) {
                alert(moveResult.popUpContent);
            }
        }

        // Function to get the row and column from the board index
        function getPositionFromIndex(position) {
            const row = Math.floor(position / 9);
            const col = position % 9;
            if (row % 2 === 1) {
                return { row, col: 8 - col };
            }
            return { row, col };
        }

        // Create the game board
        const board = document.getElementById('board');
        const boardRows = 12;
        const boardCols = 9;
        let counter = 108;

        const ladderText = ["You landed on the first leader ladder! You're making progress.", "Great job! You found another leader ladder.", "Fantastic! You climbed the third leader ladder."];
        const slopeText = ["Oh no! You slipped on the first slope.", "Watch out! You hit the second slope.", "Careful! You found the third slope."];

        for (let row = 0; row < boardRows; row++) {
            for (let col = 0; col < boardCols; col++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${row}-${col}`;
                cell.textContent = counter--;

                if (isPrime(counter + 1)) {
                    cell.style.backgroundColor = "rgba(255, 0, 0, 0.8)"; // red for prime numbers
                }

                if (row % 2 === 1) {
                    cell.style.backgroundColor = "rgba(255, 255, 153, 0.8)"; // yellow
                } else {
                    cell.style.backgroundColor = "rgba(204, 255, 153, 0.8)"; // green
                }

                board.appendChild(cell);
            }
        }

        // Randomly select a background image for the board
        const randomImage = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];
        board.style.backgroundImage = `url(${randomImage})`;

        // Initialize players
        const players = [];
        const playerCountSelect = document.getElementById('playerCount');
        const startGameButton = document.getElementById('startGame');
        const rollDiceButton = document.getElementById('rollDice');
        const toggleDebugButton = document.getElementById('toggleDebug');

        startGameButton.addEventListener('click', () => {
            const playerCount = parseInt(playerCountSelect.value, 10);
            for (let i = 1; i <= playerCount; i++) {
                const player = document.createElement('div');
                player.className = 'player';
                player.id = `player${i}`;
                board.appendChild(player);
                players.push({ id: `player${i}`, position: 107 });
                updatePlayerPosition(players[i - 1]);
            }
            rollDiceButton.disabled = false;
        });

        let currentPlayerIndex = 0;

        rollDiceButton.addEventListener('click', () => {
            const diceValue = rollDice();
            const moveResult = movePlayer(players[currentPlayerIndex], diceValue);
            updatePlayerPosition(players[currentPlayerIndex]);
            updateDebugInfo(moveResult, diceValue);

            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
        });

        toggleDebugButton.addEventListener('click', () => {
            const debugElement = document.getElementById('debug');
            if (debugElement.style.display === 'none') {
                debugElement.style.display = 'block';
            } else {
                debugElement.style.display = 'none';
            }
        });
    </script>
</body>
</html>
