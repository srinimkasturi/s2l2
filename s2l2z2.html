<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        #board-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        #board {
            display: grid;
            grid-template-columns: repeat(9, 60px);
            grid-template-rows: repeat(12, 60px);
            gap: 2px;
            border: 5px solid #333;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            background-color: #fafafa;
        }
        .cell {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #e0e0e0;
            border-radius: 5px;
            box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.2);
            font-weight: bold;
        }
        .player {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 2px solid black;
            box-sizing: border-box;
            border-radius: 50%;
        }
        #player1 { background-color: rgba(255, 0, 0, 0.8); }
        #player2 { background-color: rgba(0, 0, 255, 0.8); }
        #player3 { background-color: rgba(0, 255, 0, 0.8); }
        #player4 { background-color: rgba(255, 255, 0, 0.8); }
        #player5 { background-color: rgba(255, 0, 255, 0.8); }
        #player6 { background-color: rgba(0, 255, 255, 0.8); }
        #debug {
            display: none;
            margin-top: 20px;
            border: 1px solid black;
            padding: 10px;
            text-align: left;
            width: 80%;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <h3>Welcome to Slippers Slopes and Leaders Ladder game!</h3>
    <p>1. Landscape mode is better 2. Select: 
    <select id="playerCount">
        <option value="2">2 Players</option>
        <option value="3">3 Players</option>
        <option value="4">4 Players</option>
        <option value="5">5 Players</option>
        <option value="6">6 Players</option>
    </select>
    <button id="startGame">3. Start</button>
    <button id="rollDice" disabled>Roll Dice</button>
    </p>
    <button id="toggleDebug">Toggle Debug</button>
    <p></p>
    <div id="board-container">
        <div id="board"></div>
    </div>
    <div id="debug"></div>

    <script>
        function rollDice() {
            return Math.floor(Math.random() * 6) + 1;
        }
        function rollDiceForLadderRead() {
            return Math.floor(Math.random() * 3) + 1;
        }
        function rollDiceForSlopeRead() {
            return Math.floor(Math.random() * 2) + 1;
        }

        function isPrime(number) {
            if (number <= 1) return false;
            if (number <= 3) return true;
            if (number % 2 === 0 || number % 3 === 0) return false;
            let i = 5;
            while (i * i <= number) {
                if (number % i === 0 || number % (i + 2) === 0) return false;
                i += 6;
            }
            return true;
        }

        function getNextPrime(number) {
            let next = number + 1;
            while (!isPrime(next)) {
                next++;
            }
            return next;
        }

        function getPreviousPrime(number) {
            let prev = number - 1;
            while (!isPrime(prev)) {
                prev--;
            }
            return prev;
        }

        function movePlayer(player, diceValue) {
            let oldPosition = player.position;
            let newPosition = player.position - diceValue;
            if (newPosition >= 0) {
                player.position = newPosition;

                if (isPrime(newPosition + 1) && newPosition + 1 >= 54) {
                    const nextPrime = getNextPrime(newPosition + 1);
                    player.position = nextPrime - 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved to one prime backward ${108 - nextPrime}`, popUpContent: "You landed on a slippery slope. Move one prime backward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition) && newPosition >= 54) {
                    const prevPrevPrevPrime = getPreviousPrime(getPreviousPrime(getPreviousPrime(newPosition)));
                    player.position = prevPrevPrevPrime - 3;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved three primes forward ${108 - prevPrevPrevPrime + 3}`, popUpContent: "You landed on a leader ladder. Move three primes forward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition + 1) && newPosition + 1 >= 27 && newPosition + 1 < 54) {
                    const nextNextPrime = getNextPrime(getNextPrime(newPosition));
                    player.position = nextNextPrime + 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved two primes backward ${108 - nextNextPrime}`, popUpContent: "You landed on a slippery slope. Move two primes backward!"  + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
                } else if (isPrime(newPosition) && newPosition >= 27 && newPosition < 54) {
                    const prevPrevPrime = getPreviousPrime(getPreviousPrime(newPosition));
                    player.position = prevPrevPrime - 2;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved two primes forward ${108 - prevPrevPrime + 2}`, popUpContent: "You landed on a leader ladder. Move two primes forward!"  + "\n\n" + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition + 1)) {
                    const nextNextNextPrime = getNextPrime(getNextPrime(getNextPrime(newPosition)));
                    player.position = nextNextNextPrime + 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved three primes backward ${108 - nextNextNextPrime}`, popUpContent: "You landed on a slippery slope. Move three primes backward!"  + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
                } else if (isPrime(newPosition)) {
                    const prevPrime = getPreviousPrime(newPosition);
                    player.position = prevPrime;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved to one prime forward ${108 - prevPrime}`, popUpContent: "You landed on a leader ladder. Move one prime forward!"  + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else {
                    return { oldPosition, newPosition };
                }
            }
            return null;
        }

        function updatePlayerPosition(player) {
            const playerElement = document.getElementById(`player${player.id}`);
            const newPosition = player.position;
            const [row, column] = getPositionFromIndex(newPosition);
            playerElement.style.left = `${column * 60 + 15}px`;
            playerElement.style.top = `${row * 60 + 15}px`;
        }

        function updateDebugInfo(moveResult, diceValue) {
            if (moveResult) {
                const debugElement = document.getElementById('debug');
                const { oldPosition, newPosition, message } = moveResult;
                const [oldRow, oldColumn] = getPositionFromIndex(oldPosition);
                const [newRow, newColumn] = getPositionFromIndex(newPosition);
                debugElement.style.display = 'block';
                debugElement.innerHTML = `
                    <p><strong>Old Position:</strong> Row ${oldRow}, Column ${oldColumn}</p>
                    <p><strong>Dice Value:</strong> ${diceValue}</p>
                    <p><strong>New Position:</strong> Row ${newRow}, Column ${newColumn}</p>
                    ${message ? `<p><strong>Message:</strong> ${message}</p>` : ''}
                `;
            }
        }

        function getPositionFromIndex(index) {
            const row = Math.floor(index / 9);
            let column = index % 9;
            if (row % 2 === 1) {
                column = 8 - column;
            }
            return [row, column];
        }

        const ladderText = [
            "Well done! You read more you learnt more",
            "Good reading! Reading makes a man wise",
            "Nice read! You are much more knowledgable now"
        ];
        const slopeText = [
            "Sorry, you got distracted while reading",
            "Oh no, you took a nap while reading"
        ];

        const board = [];
        const players = [];
        let currentPlayerIndex = 0;
        let gameStarted = false;

        document.getElementById('startGame').addEventListener('click', () => {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            for (let i = 0; i < playerCount; i++) {
                players.push({ id: i + 1, position: 107 });
                const playerElement = document.createElement('div');
                playerElement.id = `player${i + 1}`;
                playerElement.classList.add('player');
                document.getElementById('board').appendChild(playerElement);
                updatePlayerPosition(players[i]);
            }
            document.getElementById('rollDice').disabled = false;
            gameStarted = true;
        });

        document.getElementById('rollDice').addEventListener('click', () => {
            if (gameStarted) {
                const currentPlayer = players[currentPlayerIndex];
                const diceValue = rollDice();
                const moveResult = movePlayer(currentPlayer, diceValue);
                if (moveResult) {
                    updatePlayerPosition(currentPlayer);
                    updateDebugInfo(moveResult, diceValue);
                    alert(moveResult.popUpContent);
                }
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            }
        });

        document.getElementById('toggleDebug').addEventListener('click', () => {
            const debugElement = document.getElementById('debug');
            debugElement.style.display = debugElement.style.display === 'none' ? 'block' : 'none';
        });

        const boardElement = document.getElementById('board');
        const numRows = 12;
        const numCols = 9;
        for (let row = 0; row < numRows; row++) {
            for (let col = 0; col < numCols; col++) {
                const cellElement = document.createElement('div');
                cellElement.classList.add('cell');
                const cellNumber = 108 - (row * 9 + col + 1);
                cellElement.textContent = cellNumber;
                boardElement.appendChild(cellElement);
            }
        }
    </script>
</body>
</html>
