<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            position: relative;
        }
        #board {
            display: inline-block;
            margin-top: 20px;
            position: relative;
        }
        .cell {
            width: 35px;
            height: 35px;
            border: 1px solid black;
            display: inline-block;
            background-color: rgba(255, 255, 153, 0.8);
            border-radius: 10px;
            margin: 1px;
        }
        .player {
            position: absolute;
            width: 15px;
            height: 15px;
            border: 2px solid black;
            box-sizing: border-box;
            z-index: 1;
            border-radius: 50%;
        }
        #player1 {
            background-color: rgba(255, 0, 0, 0.8);
        }
        #player2 {
            background-color: rgba(0, 0, 255, 0.8);
        }
        #player3 {
            background-color: rgba(0, 255, 0, 0.8);
        }
        #player4 {
            background-color: rgba(255, 255, 0, 0.8);
        }
        #player5 {
            background-color: rgba(255, 0, 255, 0.8);
        }
        #player6 {
            background-color: rgba(0, 255, 255, 0.8);
        }
        #debug {
            display: none;
            margin-top: 20px;
            border: 1px solid black;
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h3>Welcome to Slippers Slopes and Leaders Ladder game!</h3>
    <p>
        1. Landscape mode is better
        2. Select: 
        <select id="playerCount">
            <option value="2">2 Players</option>
            <option value="3">3 Players</option>
            <option value="4">4 Players</option>
            <option value="5">5 Players</option>
            <option value="6">6 Players</option>
        </select>
        <button id="startGame">3. Start</button>
        <button id="rollDice" disabled>Roll Dice</button>
    </p>
    <div id="board"></div>
    <p><button id="toggleDebug">Toggle Debug</button></p>
    <div id="debug"></div>

    <script>
        function rollDice() {
            return Math.floor(Math.random() * 6) + 1;
        }

        function rollDiceForLadderRead() {
            return Math.floor(Math.random() * 3);
        }

        function rollDiceForSlopeRead() {
            return Math.floor(Math.random() * 2);
        }

        function isPrime(number) {
            if (number <= 1) return false;
            if (number <= 3) return true;
            if (number % 2 === 0 || number % 3 === 0) return false;
            let i = 5;
            while (i * i <= number) {
                if (number % i === 0 || number % (i + 2) === 0) return false;
                i += 6;
            }
            return true;
        }

        function getNextPrime(number) {
            let next = number + 1;
            while (!isPrime(next)) {
                next++;
            }
            return next;
        }

        function getPreviousPrime(number) {
            let prev = number - 1;
            while (!isPrime(prev)) {
                prev--;
            }
            return prev;
        }

        function movePlayer(player, diceValue) {
            let oldPosition = player.position;
            let newPosition = player.position - diceValue;

            if (newPosition >= 0) {
                player.position = newPosition;

                if (isPrime(newPosition + 1) && newPosition + 1 >= 54) {
                    const nextPrime = getNextPrime(newPosition + 1);
                    player.position = nextPrime - 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved to one prime backward ${108 - nextPrime + 1}`, popUpContent: "You landed on a slippery slope. Move one prime backward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition) && newPosition >= 54) {
                    const prevPrevPrevPrime = getPreviousPrime(getPreviousPrime(getPreviousPrime(newPosition)));
                    player.position = prevPrevPrevPrime - 3;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved three primes forward ${108 - prevPrevPrevPrime + 3}`, popUpContent: "You landed on a leader ladder. Move three primes forward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition + 1) && newPosition + 1 >= 27 && newPosition + 1 < 54) {
                    const nextNextPrime = getNextPrime(getNextPrime(newPosition));
                    player.position = nextNextPrime + 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved two primes backward ${108 - nextNextPrime - 1}`, popUpContent: "You landed on a slippery slope. Move two primes backward!"  + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
                } else if (isPrime(newPosition) && newPosition >= 27 && newPosition < 54) {
                    const prevPrevPrime = getPreviousPrime(getPreviousPrime(newPosition));
                    player.position = prevPrevPrime - 2;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved two primes forward ${108 - prevPrevPrime + 2}`, popUpContent: "You landed on a leader ladder. Move two primes forward!"  + "\n\n" + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition + 1)) {
                    const nextNextNextPrime = getNextPrime(getNextPrime(getNextPrime(newPosition)));
                    player.position = nextNextNextPrime + 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved three primes backward ${108 - nextNextNextPrime - 1}`, popUpContent: "You landed on a slippery slope. Move three primes backward!"  + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
                } else if (isPrime(newPosition)) {
                    const prevPrime = getPreviousPrime(newPosition);
                    player.position = prevPrime;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved to one prime forward ${108 - prevPrime}`, popUpContent: "You landed on a leader ladder. Move one prime forward!"  + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else {
                    return { oldPosition, newPosition };
                }
            }
            return null;
        }

        function updatePlayerPosition(player) {
            const playerElement = document.getElementById(`player${player.id}`);
            const [row, column] = getPositionFromIndex(player.position);
            const leftPosition = playerTopLeft[row][column][0];
            const topPosition = playerTopLeft[row][column][1];

            playerElement.style.left = `${leftPosition}px`;
            playerElement.style.top = `${topPosition}px`;
        }

        function updateDebugInfo(moveResult, diceValue) {
            if (moveResult) {
                const debugElement = document.getElementById('debug');
                const { oldPosition, newPosition, message } = moveResult;
                const [oldRow, oldColumn, oldCellValue] = getPositionFromIndex(oldPosition);
                const [newRow, newColumn, newCellValue] = getPositionFromIndex(newPosition);
                const primeMoveCount = Math.abs(oldPosition - newPosition);
                debugElement.style.display = 'block';
                if (message) {
                    debugElement.innerHTML = `
                        <p><strong>Old Position:</strong> Row ${oldRow}, Column ${oldColumn}, Value ${oldCellValue}</p>
                        <p><strong>Dice Value:</strong> ${diceValue}</p>
                        <p><strong>New Position:</strong> Row ${newRow}, Column ${newColumn}, Value ${newCellValue}</p>
                        <p><strong>Message:</strong> ${message}</p>
                        <p><strong>Prime Move Count:</strong> ${primeMoveCount}</p>
                    `;
                } else {
                    debugElement.innerHTML = `
                        <p><strong>Old Position:</strong> Row ${oldRow}, Column ${oldColumn}, Value ${oldCellValue}</p>
                        <p><strong>Dice Value:</strong> ${diceValue}</p>
                        <p><strong>New Position:</strong> Row ${newRow}, Column ${newColumn}, Value ${newCellValue}</p>
                    `;
                }
            }
        }

        function getPositionFromIndex(position) {
            const boardSize = 10;
            const row = Math.floor(position / boardSize);
            const column = position % boardSize;
            const cellValue = (boardSize * boardSize) - position;
            return [row, column, cellValue];
        }

        const ladderText = ["You find a friend in the shadows, they lend you a boost!", "A strong gust of wind helps you ascend.", "A friendly bird gives you a ride!"];
        const slopeText = ["A rock rolls you back down!", "A misstep causes you to slide back.", "The ground is slippery, and you fall down!"];
        const boardSize = 10;
        const totalCells = boardSize * boardSize;
        const playerTopLeft = [
            [[0, 0], [40, 0], [80, 0], [120, 0], [160, 0], [200, 0], [240, 0], [280, 0], [320, 0], [360, 0]],
            [[0, 40], [40, 40], [80, 40], [120, 40], [160, 40], [200, 40], [240, 40], [280, 40], [320, 40], [360, 40]],
            [[0, 80], [40, 80], [80, 80], [120, 80], [160, 80], [200, 80], [240, 80], [280, 80], [320, 80], [360, 80]],
            [[0, 120], [40, 120], [80, 120], [120, 120], [160, 120], [200, 120], [240, 120], [280, 120], [320, 120], [360, 120]],
            [[0, 160], [40, 160], [80, 160], [120, 160], [160, 160], [200, 160], [240, 160], [280, 160], [320, 160], [360, 160]],
            [[0, 200], [40, 200], [80, 200], [120, 200], [160, 200], [200, 200], [240, 200], [280, 200], [320, 200], [360, 200]],
            [[0, 240], [40, 240], [80, 240], [120, 240], [160, 240], [200, 240], [240, 240], [280, 240], [320, 240], [360, 240]],
            [[0, 280], [40, 280], [80, 280], [120, 280], [160, 280], [200, 280], [240, 280], [280, 280], [320, 280], [360, 280]],
            [[0, 320], [40, 320], [80, 320], [120, 320], [160, 320], [200, 320], [240, 320], [280, 320], [320, 320], [360, 320]],
            [[0, 360], [40, 360], [80, 360], [120, 360], [160, 360], [200, 360], [240, 360], [280, 360], [320, 360], [360, 360]]
        ];

        document.getElementById('startGame').addEventListener('click', function() {
            const playerCount = parseInt(document.getElementById('playerCount').value, 10);
            startGame(playerCount);
        });

        document.getElementById('rollDice').addEventListener('click', function() {
            rollDiceAndMovePlayer();
        });

        document.getElementById('toggleDebug').addEventListener('click', function() {
            const debugElement = document.getElementById('debug');
            debugElement.style.display = debugElement.style.display === 'none' ? 'block' : 'none';
        });

        const players = [];
        let currentPlayerIndex = 0;

        function startGame(playerCount) {
            document.getElementById('board').innerHTML = '';
            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.innerText = totalCells - (i * boardSize + j);
                    document.getElementById('board').appendChild(cell);
                }
            }

            for (let i = 1; i <= playerCount; i++) {
                const player = document.createElement('div');
                player.className = 'player';
                player.id = `player${i}`;
                player.style.left = `${playerTopLeft[0][0][0]}px`;
                player.style.top = `${playerTopLeft[0][0][1]}px`;
                document.getElementById('board').appendChild(player);
                players.push({ id: i, position: 0 });
            }

            document.getElementById('rollDice').disabled = false;
        }

        function rollDiceAndMovePlayer() {
            const diceValue = rollDice();
            const player = players[currentPlayerIndex];
            const moveResult = movePlayer(player, diceValue);
            if (moveResult) {
                updatePlayerPosition(player);
                updateDebugInfo(moveResult, diceValue);

                const popUpElement = document.createElement('div');
                popUpElement.innerText = moveResult.popUpContent;
                popUpElement.style.position = 'fixed';
                popUpElement.style.left = '50%';
                popUpElement.style.top = '50%';
                popUpElement.style.transform = 'translate(-50%, -50%)';
                popUpElement.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
                popUpElement.style.border = '1px solid black';
                popUpElement.style.padding = '20px';
                popUpElement.style.zIndex = '1000';

                document.body.appendChild(popUpElement);

                setTimeout(() => {
                    document.body.removeChild(popUpElement);
                }, 3000);
            }

            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
        }
    </script>
</body>
</html>
