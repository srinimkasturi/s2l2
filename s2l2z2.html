<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            position: relative; /* Ensure body acts as the containing block for absolutely positioned elements */
        }
        #board {
            display: inline-block;
            margin-top: 20px;
            position: relative; /* Set the position to relative to establish a containing block for absolutely positioned player */
        }
        .cell {
            width: 35px;
            height: 35px;
            border: 1px solid black;
            display: inline-block;
            background-color: rgba(255, 255, 153, 0.8); /* Pale and color-blind accessible color with some transparency */
            border-radius: 10px; /* Smoother edges */
            margin: 1px; /* Add some space between cells */
        }
        .player {
            position: absolute; /* Position the player div relative to its containing block */
            width: 15px; /* Half width as a cell */
            height: 15px; /* Half height as a cell */
            border: 2px solid black; /* Add a border for better visibility */
            box-sizing: border-box; /* Include border in width and height */
            z-index: 1; /* Set a higher z-index to ensure the player is above the board */
            border-radius: 50%; /* Make the player a circle */
        }
        #player1 {
            background-color: rgba(255, 0, 0, 0.8); /* Red color with some transparency */
        }
        #player2 {
            background-color: rgba(0, 0, 255, 0.8); /* Blue color with some transparency */
        }
        #player3 {
            background-color: rgba(0, 255, 0, 0.8); /* Green color with some transparency */
        }
        #player4 {
            background-color: rgba(255, 255, 0, 0.8); /* Yellow color with some transparency */
        }
        #player5 {
            background-color: rgba(255, 0, 255, 0.8); /* Magenta color with some transparency */
        }
        #player6 {
            background-color: rgba(0, 255, 255, 0.8); /* Cyan color with some transparency */
        }
        #notification {
            display: none; /* Hide notification div by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid black;
            padding: 10px;
            z-index: 1000; /* Ensure the notification div is above other elements */
        }
        #notification p {
            margin: 0;
        }
        #pauseButton {
            margin-left: 20px;
        }
        #debug {
            display: none; /* Hide debug div by default */
            margin-top: 20px;
            border: 1px solid black;
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h3>Slippers Slopes and Leaders Ladder!</h3>
    <p>1. Select: 
    <select id="playerCount">
        <option value="2">2 Players</option>
        <option value="3">3 Players</option>
        <option value="4">4 Players</option>
        <option value="5">5 Players</option>
        <option value="6">6 Players</option>
    </select>
    <button id="startGame">2. Start</button> 
    <button id="rollDice" disabled>3. Roll Dice</button>
    </p>
    <div id="board"></div>
    <p></p>
    <p>
        <button id="toggleDebug">Toggle Debug</button>
        <div id="debug"></div>
    </p>
    <div id="notification">
        <p id="notificationText"></p>
        <button id="pauseButton">Pause</button>
    </div>
    <script>
        // Function to generate a random dice value (1 to 6)
        function rollDice() {
            return Math.floor(Math.random() * 6) + 1;
        }
        // Function to generate a random dice value (1 to 3)
        function rollDiceForLadderRead() {
            return Math.floor(Math.random() * 3);
        }
        // Function to generate a random dice value (1 to 2)
        function rollDiceForSlopeRead() {
            return Math.floor(Math.random() * 2);
        }

        // Function to check if a number is prime
        function isPrime(number) {
            if (number <= 1) return false;
            if (number <= 3) return true;
            if (number % 2 === 0 || number % 3 === 0) return false;
            let i = 5;
            while (i * i <= number) {
                if (number % i === 0 || number % (i + 2) === 0) return false;
                i += 6;
            }
            return true;
        }

        // Function to find the next prime number
        function getNextPrime(number) {
            let next = number + 1;
            while (!isPrime(next)) {
                next++;
            }
            return next;
        }

        // Function to find the previous prime number
        function getPreviousPrime(number) {
            let prev = number - 1;
            while (!isPrime(prev)) {
                prev--;
            }
            return prev;
        }

        // Function to move the player on the board
        function movePlayer(player, diceValue) {
            // Calculate the new position
            let oldPosition = player.position;
            let newPosition = player.position - diceValue;
            // Check if the new position is within the board bounds
            if (newPosition >= 0) {
                // Update the player's position
                // In the beginning go up ladder fast, later on fall slopes fast
                player.position = newPosition;

                if (isPrime(newPosition + 1) && newPosition + 1 >= 54) {
                    const nextPrime = getNextPrime(newPosition + 1);
                    player.position = nextPrime - 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved to one prime backward ${108 - nextPrime + 1}`, popUpContent: "You landed on a slippery slope. Move one prime backward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition) && newPosition >= 54) {
                    const prevPrevPrevPrime = getPreviousPrime(getPreviousPrime(getPreviousPrime(newPosition)));
                    player.position = prevPrevPrevPrime - 3;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved three primes forward ${108 - prevPrevPrevPrime + 3}`, popUpContent: "You landed on a leader ladder. Move three primes forward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition + 1) && newPosition + 1 >= 27 && newPosition + 1 < 54) {
                    const nextNextPrime = getNextPrime(getNextPrime(newPosition));
                    player.position = nextNextPrime + 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved two primes backward ${108 - nextNextPrime - 1}`, popUpContent: "You landed on a slippery slope. Move two primes backward!"  + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
                } else if (isPrime(newPosition) && newPosition >= 27 && newPosition < 54) {
                    const prevPrevPrime = getPreviousPrime(getPreviousPrime(newPosition));
                    player.position = prevPrevPrime - 2;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved two primes forward ${108 - prevPrevPrime + 2}`, popUpContent: "You landed on a leader ladder. Move two primes forward!"  + "\n\n" + ladderText[rollDiceForLadderRead()] };
                } else if (isPrime(newPosition + 1)) {
                    const nextNextNextPrime = getNextPrime(getNextPrime(getNextPrime(newPosition)));
                    player.position = nextNextNextPrime + 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved three primes backward ${108 - nextNextNextPrime - 1}`, popUpContent: "You landed on a slippery slope. Move three primes backward!" + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
                } else if (isPrime(newPosition)) {
                    const prevPrime = getPreviousPrime(newPosition);
                    player.position = prevPrime;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved to one prime forward ${108 - prevPrime}`, popUpContent: "You landed on a leader ladder. Move one prime forward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
                } else {
                    return { oldPosition, newPosition }; // Player moved successfully
                }
            }
            return null; // Player couldn't move to any cell
        }

        // Function to update the player's position on the board
        function updatePlayerPosition(player) {
            const playerElement = document.getElementById(`player${player.id}`);
            const [row, column] = getPositionFromIndex(player.position);
            const boardWidth = document.getElementById('board').offsetWidth; // Get the width of the board
            const cellWidth = boardWidth / board[0].length; // Calculate width of each cell

            // Calculate the player's position in pixels
            const left = column * cellWidth + (cellWidth / 2) - (playerElement.offsetWidth / 2);
            const top = row * cellWidth + (cellWidth / 2) - (playerElement.offsetHeight / 2);

            // Update the player's position
            playerElement.style.left = `${left}px`;
            playerElement.style.top = `${top}px`;
        }

        // Function to convert a 1D array index to a 2D array position
        function getPositionFromIndex(index) {
            const columns = 6; // Number of columns on the board
            const row = Math.floor(index / columns);
            const column = index % columns;
            return [row, column];
        }

        // Function to show notification
        function showNotification(message) {
            const notificationDiv = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            notificationText.textContent = message;
            notificationDiv.style.display = 'block';

            // Set a timeout to hide the notification after 15 seconds
            notificationTimeout = setTimeout(() => {
                notificationDiv.style.display = 'none';
            }, 15000);
        }

        // Event listener for pause button
        document.getElementById('pauseButton').addEventListener('click', () => {
            clearTimeout(notificationTimeout);
        });

        let players = [];
        let currentPlayerIndex = 0;
        let notificationTimeout;

        // Board array to store the positions
        const board = [];
        for (let i = 0; i < 18; i++) {
            const row = [];
            for (let j = 0; j < 6; j++) {
                row.push('');
            }
            board.push(row);
        }

        // Initialize the board
        function initializeBoard() {
            const boardDiv = document.getElementById('board');
            boardDiv.innerHTML = ''; // Clear the board
            for (let i = 0; i < 18; i++) {
                for (let j = 0; j < 6; j++) {
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'cell';
                    boardDiv.appendChild(cellDiv);
                }
                const br = document.createElement('br');
                boardDiv.appendChild(br);
            }
        }

        // Initialize the game
        document.getElementById('startGame').addEventListener('click', () => {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            players = [];
            for (let i = 1; i <= playerCount; i++) {
                players.push({
                    id: i,
                    position: 107 // Starting position
                });
            }
            currentPlayerIndex = 0;
            initializeBoard();
            updateAllPlayerPositions();
            document.getElementById('rollDice').disabled = false;
        });

        // Roll the dice and move the current player
        document.getElementById('rollDice').addEventListener('click', () => {
            const diceValue = rollDice();
            const player = players[currentPlayerIndex];
            const result = movePlayer(player, diceValue);

            if (result) {
                updatePlayerPosition(player);
                if (result.popUpContent) {
                    showNotification(result.popUpContent);
                }
            }

            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
        });

        // Toggle debug information
        document.getElementById('toggleDebug').addEventListener('click', () => {
            const debugDiv = document.getElementById('debug');
            if (debugDiv.style.display === 'none') {
                debugDiv.style.display = 'block';
            } else {
                debugDiv.style.display = 'none';
            }
        });

        // Function to update all players' positions on the board
        function updateAllPlayerPositions() {
            for (const player of players) {
                const playerElement = document.getElementById(`player${player.id}`);
                if (!playerElement) {
                    const newPlayerElement = document.createElement('div');
                    newPlayerElement.id = `player${player.id}`;
                    newPlayerElement.className = 'player';
                    newPlayerElement.style.backgroundColor = player.color;
                    document.getElementById('board').appendChild(newPlayerElement);
                }
                updatePlayerPosition(player);
            }
        }

        // Add player elements to the board
        for (let i = 1; i <= 6; i++) {
            const playerElement = document.createElement('div');
            playerElement.id = `player${i}`;
            playerElement.className = 'player';
            document.getElementById('board').appendChild(playerElement);
        }
    </script>
</body>
</html>
