<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #board-container {
            position: relative;
            margin-top: 20px;
        }
        #board {
            display: inline-block;
            position: relative;
            background-color: #f0f0f0;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .cell {
            width: 5vw;
            height: 5vw;
            border: 1px solid #ddd;
            display: inline-block;
            background-color: #ffffff;
            border-radius: 10px;
            margin: 1px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .player {
            position: absolute;
            width: 3vw;
            height: 3vw;
            border: 2px solid black;
            box-sizing: border-box;
            z-index: 1;
            border-radius: 50%;
        }
        #debug {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            margin-top: 20px;
            border: 1px solid black;
            padding: 10px;
            text-align: left;
            background-color: white;
        }
    </style>
</head>
<body>
    <h3>Welcome to Slippers Slopes and Leaders Ladder game!</h3>
    <p>1. Landscape mode is better</p>
    <p>2. Select: 
    <select id="playerCount">
        <option value="2">2 Players</option>
        <option value="3">3 Players</option>
        <option value="4">4 Players</option>
        <option value="5">5 Players</option>
        <option value="6">6 Players</option>
    </select>
    <button id="startGame">3. Start</button>
    <button id="rollDice" disabled>Roll Dice</button>
    </p>
    <button id="toggleDebug">Toggle Debug</button>
    <p></p>
    <div id="board-container">
        <div id="board"></div>
        <div id="debug"></div>
    </div>

    <script>
        // Function to generate a random dice value (1 to 6)
        function rollDice() {
            return Math.floor(Math.random() * 6) + 1;
        }

        // Function to check if a number is prime
        function isPrime(number) {
            if (number <= 1) return false;
            if (number <= 3) return true;
            if (number % 2 === 0 || number % 3 === 0) return false;
            let i = 5;
            while (i * i <= number) {
                if (number % i === 0 || number % (i + 2) === 0) return false;
                i += 6;
            }
            return true;
        }

        // Function to find the next prime number
        function getNextPrime(number) {
            let next = number + 1;
            while (!isPrime(next)) {
                next++;
            }
            return next;
        }

        // Function to find the previous prime number
        function getPreviousPrime(number) {
            let prev = number - 1;
            while (!isPrime(prev)) {
                prev--;
            }
            return prev;
        }

        // Function to move the player on the board
        function movePlayer(player, diceValue) {
            // Calculate the new position
            let oldPosition = player.position;
            let newPosition = player.position - diceValue;
            // Check if the new position is within the board bounds
            if (newPosition >= 0) {
                // Update the player's position
                player.position = newPosition;

                if (isPrime(newPosition + 1) && newPosition + 1 >= 54) {
                    const nextPrime = getNextPrime(newPosition + 1);
                    player.position = nextPrime - 1;
                    return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved to one prime backward ${108 - nextPrime}` };
                } else if (isPrime(newPosition) && newPosition >= 54) {
                    const prevPrevPrevPrime = getPreviousPrime(getPreviousPrime(getPreviousPrime(newPosition)));
                    player.position = prevPrevPrevPrime - 3;
                    return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved three primes forward ${108 - prevPrevPrevPrime + 3}` };
                } else {
                    return { oldPosition, newPosition }; // Player moved successfully
                }
            }
            return null; // Player couldn't move to any cell
        }

        // Function to update the player's position on the board
        function updatePlayerPosition(player) {
            const playerElement = document.getElementById(`player${player.id}`);
            const [row, column] = getPositionFromIndex(player.position);
            const boardWidth = document.getElementById('board').offsetWidth; // Get the width of the board
            const cellWidth = boardWidth / board[0].length; // Calculate width of each cell

            // Calculate position of player relative to board size
            const leftPosition = (column * cellWidth) + (cellWidth / 2) - (playerElement.offsetWidth / 2);
            const topPosition = (row * cellWidth) + (cellWidth / 2) - (playerElement.offsetHeight / 2);

            // Set the position of the player marker within the cell
            playerElement.style.left = `${leftPosition}px`;
            playerElement.style.top = `${topPosition}px`;
        }

        // Function to update the debug information
        function updateDebugInfo(moveResult, diceValue) {
            if (moveResult) {
                const debugElement = document.getElementById('debug');
                const { oldPosition, newPosition, message } = moveResult;
                debugElement.style.display = 'block';
                debugElement.innerHTML = `
                    <p><strong>Old Position:</strong> ${oldPosition}</p>
                    <p><strong>Dice Value:</strong> ${diceValue}</p>
                    <p><strong>New Position:</strong> ${newPosition}</p>
                    <p><strong>Message:</strong> ${message}</p>
                `;
            }
        }

        // Function to calculate row and column from position index
        function getPositionFromIndex(position) {
            const row = Math.floor(position / board[0].length);
            const column = position % board[0].length;
            return [row, column];
        }

        // Create the game board
        const boardElement = document.getElementById('board');
        const board = [
            [108, 107, 106, 105, 104, 103, 102, 101, 100, 99, 98, 97],
            [85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96],
            [84, 83, 82, 81, 80, 79, 78, 77, 76, 75, 74, 73],
            [61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72],
            [60, 59, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49],
            [37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
            [36, 35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 25],
            [13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24],
            [12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
        ];

        // Create players array
        let players = [];
        let currentPlayerIndex = 0;

        // Function to create players based on selected count
        function createPlayers(count) {
            players = [];
            for (let i = 1; i <= count; i++) {
                players.push({ id: i, position: 107 });
                const playerElement = document.createElement('div');
                playerElement.classList.add('player');
                playerElement.id = `player${i}`;
                boardElement.appendChild(playerElement);
            }
        }

        // Function to handle the start game button click event
        document.getElementById('startGame').addEventListener('click', function() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            createPlayers(playerCount);
            document.getElementById('rollDice').disabled = false; // Enable roll dice button
            document.getElementById('startGame').disabled = true; // Disable start game button
        });

        // Function to handle the roll dice button click event
        document.getElementById('rollDice').addEventListener('click', function() {
            const currentPlayer = players[currentPlayerIndex];
            const diceValue = rollDice();
            const moveResult = movePlayer(currentPlayer, diceValue);
            updatePlayerPosition(currentPlayer);
            updateDebugInfo(moveResult, diceValue);

            // Move to the next player
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;

            // Show pop-up if player landed on a ladder or slope
            if (moveResult && moveResult.message) {
                alert(moveResult.message);
            }
        });

        // Function to handle the toggle debug button click event
        document.getElementById('toggleDebug').addEventListener('click', function() {
            const debugElement = document.getElementById('debug');
            debugElement.style.display = debugElement.style.display === 'none' ? 'block' : 'none';
        });

        // Initialize players' positions
        players.forEach(player => updatePlayerPosition(player));
    </script>
</body>
</html>
