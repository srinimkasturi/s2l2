<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            position: relative; /* Ensure body acts as the containing block for absolutely positioned elements */
            background-image: url('https://vedicsidhaanta.blogspot.com/2018/02/the-dashavatara-part-1-birth-of-krishna.html');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: #333; /* Ensure text is readable */
        }
        #background-url {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(255, 255, 255, 0.7);
            color: #333;
            padding: 10px;
            text-align: center;
            font-size: 12px;
        }
        #board {
            display: inline-block;
            margin-top: 20px;
            position: relative; /* Set the position to relative to establish a containing block for absolutely positioned player */
        }
        .cell {
            width: 35px;
            height: 35px;
            border: 1px solid black;
            display: inline-block;
            background-color: rgba(255, 255, 153, 0.8); /* Pale and color-blind accessible color with some transparency */
            border-radius: 10px; /* Smoother edges */
            margin: 1px; /* Add some space between cells */
        }
        .player {
            position: absolute; /* Position the player div relative to its containing block */
            width: 15px; /* Half width as a cell */
            height: 15px; /* Half height as a cell */
            border: 2px solid black; /* Add a border for better visibility */
            box-sizing: border-box; /* Include border in width and height */
            z-index: 1; /* Set a higher z-index to ensure the player is above the board */
            border-radius: 50%; /* Make the player a circle */
        }
        #player1 {
            background-color: rgba(255, 0, 0, 0.8); /* Red color with some transparency */
        }
        #player2 {
            background-color: rgba(0, 0, 255, 0.8); /* Blue color with some transparency */
        }
        #player3 {
            background-color: rgba(0, 255, 0, 0.8); /* Green color with some transparency */
        }
        #player4 {
            background-color: rgba(255, 255, 0, 0.8); /* Yellow color with some transparency */
        }
        #player5 {
            background-color: rgba(255, 0, 255, 0.8); /* Magenta color with some transparency */
        }
        #player6 {
            background-color: rgba(0, 255, 255, 0.8); /* Cyan color with some transparency */
        }
        #debug {
            display: none; /* Hide debug div by default */
            margin-top: 20px;
            border: 1px solid black;
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h3>Slippers Slopes and Leaders Ladder!</h3>
    <p>1. Select: 
    <select id="playerCount">
        <option value="2">2 Players</option>
        <option value="3">3 Players</option>
        <option value="4">4 Players</option>
        <option value="5">5 Players</option>
        <option value="6">6 Players</option>
    </select>
    <button id="startGame">2. Start</button> 
    <button id="rollDice" disabled>3. Roll Dice</button>
    </p>
    <div id="board"></div>
    <p></p>
    <p>
	<button id="toggleDebug">Toggle Debug</button>
        <div id="debug"></div>
    </p>
    <div id="background-url">Background image source: <a href="https://vedicsidhaanta.blogspot.com/2018/02/the-dashavatara-part-1-birth-of-krishna.html" target="_blank">The Dashavatara - Part 1: Birth of Krishna</a></div>
	
    <script>
        // Function to generate a random dice value (1 to 6)
        function rollDice() {
            return Math.floor(Math.random() * 6) + 1;
        }
        // Function to generate a random dice value (1 to 3)
        function rollDiceForLadderRead() {
            return Math.floor(Math.random() * 3) ;
        }
        // Function to generate a random dice value (1 to 2)
        function rollDiceForSlopeRead() {
            return Math.floor(Math.random() * 2) ;
        }

        // Function to check if a number is prime
        function isPrime(number) {
            if (number <= 1) return false;
            if (number <= 3) return true;
            if (number % 2 === 0 || number % 3 === 0) return false;
            let i = 5;
            while (i * i <= number) {
                if (number % i === 0 || number % (i + 2) === 0) return false;
                i += 6;
            }
            return true;
        }

        // Function to find the next prime number
        function getNextPrime(number) {
            let next = number + 1;
            while (!isPrime(next)) {
                next++;
            }
            return next;
        }

        // Function to find the previous prime number
        function getPreviousPrime(number) {
            let prev = number - 1;
            while (!isPrime(prev)) {
                prev--;
            }
            return prev;
        }

// Function to move the player on the board
function movePlayer(player, diceValue) {
    // Calculate the new position
    let oldPosition = player.position;
    let newPosition = player.position - diceValue;
    // Check if the new position is within the board bounds
    if (newPosition >= 0) {
        // Update the player's position
        // In the beginning go up ladder fast, later on fall slopes fast
        player.position = newPosition;

        if (isPrime(newPosition + 1) && newPosition + 1 >= 54) {
            const nextPrime = getNextPrime(newPosition + 1);
            player.position = nextPrime - 1;
            return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved to one prime backward ${108 - nextPrime + 1}`, popUpContent: "You landed on a slippery slope. You slid a bit backward!" + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
        } else if (isPrime(newPosition) && newPosition >= 54) {
            const prevPrevPrevPrime = getPreviousPrime(getPreviousPrime(getPreviousPrime(newPosition)));
            player.position = prevPrevPrevPrime - 3;
            return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved three primes forward ${108 - prevPrevPrevPrime + 3}`, popUpContent: "You landed on a leader ladder. You jumped way forward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
        } else if (isPrime(newPosition + 1) && newPosition + 1 >= 27 && newPosition + 1 < 54) {
            const nextNextPrime = getNextPrime(getNextPrime(newPosition));
            player.position = nextNextPrime + 1;
            return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved two primes backward ${108 - nextNextPrime - 1}`, popUpContent: "You landed on a slippery slope. You slid backward!"  + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
        } else if (isPrime(newPosition) && newPosition >= 27 && newPosition < 54) {
            const prevPrevPrime = getPreviousPrime(getPreviousPrime(newPosition));
            player.position = prevPrevPrime - 2;
            return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved two primes forward ${108 - prevPrevPrime + 2}`, popUpContent: "You landed on a leader ladder. You jumped quite a bit forward!"  + "\n\n" + ladderText[rollDiceForLadderRead()] };
        } else if (isPrime(newPosition + 1)) {
            const nextNextNextPrime = getNextPrime(getNextPrime(getNextPrime(newPosition)));
            player.position = nextNextNextPrime + 1;
            return { oldPosition, newPosition, message: `Player landed on Slippery Slope, moved three primes backward ${108 - nextNextNextPrime - 1}`, popUpContent: "You landed on a slippery slope. You slid way back!"  + "\n\n"  + slopeText[rollDiceForSlopeRead()] };
        } else if (isPrime(newPosition)) {
            const prevPrime = getPreviousPrime(newPosition);
            player.position = prevPrime - 1;
            return { oldPosition, newPosition, message: `Player landed on Leader Ladder, moved one prime forward ${108 - prevPrime + 1}`, popUpContent: "You landed on a leader ladder. You jumped a bit forward!" + "\n\n"  + ladderText[rollDiceForLadderRead()] };
        } else {
            // No special condition, just move the player
            player.position = newPosition;
            return { oldPosition, newPosition, message: `Player moved from ${108 - oldPosition} to ${108 - newPosition}`, popUpContent: "" };
        }
    } else {
        return { oldPosition, newPosition: oldPosition, message: `Player cannot move, stays at ${108 - oldPosition}`, popUpContent: "" };
    }
}

        // Function to render the board
        function renderBoard(players) {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = ''; // Clear the board

            // Create cells for the board
            for (let i = 107; i >= 0; i--) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.cellIndex = i;
                boardElement.appendChild(cell);
            }

            // Create player elements
            players.forEach(player => {
                const playerElement = document.createElement('div');
                playerElement.classList.add('player');
                playerElement.id = `player${player.id}`;
                boardElement.appendChild(playerElement);
                updatePlayerPosition(player);
            });
        }

        // Function to update player position on the board
        function updatePlayerPosition(player) {
            const playerElement = document.getElementById(`player${player.id}`);
            const cellSize = 37; // Size of the cell (including borders and margin)
            const rowLength = 9; // Number of cells in a row
            const xOffset = 12; // Offset for the player position within the cell
            const yOffset = 12; // Offset for the player position within the cell

            // Calculate row and column based on the player's position
            const row = Math.floor(player.position / rowLength);
            const col = player.position % rowLength;

            // Calculate the x and y position for the player
            const xPos = col * cellSize + xOffset;
            const yPos = row * cellSize + yOffset;

            // Update the player element's style to move it to the new position
            playerElement.style.transform = `translate(${xPos}px, ${yPos}px)`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const startGameButton = document.getElementById('startGame');
            const rollDiceButton = document.getElementById('rollDice');
            const debugDiv = document.getElementById('debug');
            const toggleDebugButton = document.getElementById('toggleDebug');
            let players = [];
            let currentPlayerIndex = 0;

            // Text for pop-ups
            const ladderText = [
                "Success usually comes to those who are too busy to be looking for it.",
                "Don't be afraid to give up the good to go for the great.",
                "I find that the harder I work, the more luck I seem to have."
            ];

            const slopeText = [
                "Success is not final; failure is not fatal: It is the courage to continue that counts.",
                "It is better to fail in originality than to succeed in imitation.",
                "The road to success and the road to failure are almost exactly the same."
            ];

            // Start game event listener
            startGameButton.addEventListener('click', () => {
                const playerCount = parseInt(document.getElementById('playerCount').value);
                players = [];

                // Initialize players
                for (let i = 1; i <= playerCount; i++) {
                    players.push({ id: i, position: 107 }); // Starting position at cell 108 (index 107)
                }

                renderBoard(players);
                currentPlayerIndex = 0;
                rollDiceButton.disabled = false; // Enable the Roll Dice button
            });

            // Roll dice event listener
            rollDiceButton.addEventListener('click', () => {
                const diceValue = rollDice();
                const currentPlayer = players[currentPlayerIndex];
                const { oldPosition, newPosition, message, popUpContent } = movePlayer(currentPlayer, diceValue);

                // Log the move in the debug div
                const moveLog = document.createElement('div');
                moveLog.textContent = `Player ${currentPlayer.id} rolled a ${diceValue}: ${message}`;
                debugDiv.appendChild(moveLog);

                // Update the player's position on the board
                updatePlayerPosition(currentPlayer);

                // Show an alert with the pop-up content if any
                if (popUpContent) {
                    alert(popUpContent);
                }

                // Check for the end of the game
                if (currentPlayer.position === 0) {
                    alert(`Player ${currentPlayer.id} wins!`);
                    rollDiceButton.disabled = true; // Disable the Roll Dice button
                } else {
                    // Move to the next player
                    currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                }
            });

            // Toggle debug information visibility
            toggleDebugButton.addEventListener('click', () => {
                debugDiv.style.display = debugDiv.style.display === 'none' ? 'block' : 'none';
            });
        });
    </script>
</body>
</html>
